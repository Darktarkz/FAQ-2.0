<div class="formulario-soporte-container">
  <div class="header-soporte">
    <div class="header-icon">üé´</div>
    <h2>Soporte T√©cnico</h2>
    <p class="modulo-nombre">{{ moduloNombre }}</p>
  </div>

  <!-- Mensaje de √©xito -->
  <div *ngIf="mostrarExito" class="alerta alerta-exito">
    <div class="alerta-contenido">
      <span class="icono-exito">‚úì</span>
      <div>
        <strong>¬°Ticket creado exitosamente!</strong>
        <p>
          Tu ticket n√∫mero <strong>{{ numeroTicket }}</strong> ha sido registrado. Te contactaremos
          pronto al correo proporcionado.
        </p>
      </div>
    </div>
    <button class="btn-cerrar-alerta" (click)="cerrarMensajeExito()">√ó</button>
  </div>

  <!-- Mensaje de error -->
  <div *ngIf="mostrarError" class="alerta alerta-error">
    <div class="alerta-contenido">
      <span class="icono-error">‚ö†</span>
      <div>
        <strong>Error</strong>
        <p>{{ mensajeError }}</p>
      </div>
    </div>
    <button class="btn-cerrar-alerta" (click)="cerrarMensajeError()">√ó</button>
  </div>

  <form (ngSubmit)="enviarTicket()" class="form-soporte">
    <!-- Campos Din√°micos Configurables -->
    <div class="seccion-formulario" *ngIf="camposPersonalizados.length > 0">
      <h3>üìù Informaci√≥n del Ticket</h3>

      <div *ngFor="let campo of camposPersonalizados" class="form-group">
        <!-- Label -->
        <label [for]="campo.nombre_campo">
          {{ campo.etiqueta }}
          <span class="requerido" *ngIf="campo.requerido">*</span>
        </label>

        <!-- Campo TEXT -->
        <input
          *ngIf="campo.tipo === 'text'"
          type="text"
          [id]="campo.nombre_campo"
          [(ngModel)]="valoresCamposPersonalizados[campo.nombre_campo]"
          [name]="campo.nombre_campo"
          [placeholder]="campo.placeholder || ''"
          [required]="campo.requerido"
        />

        <!-- Campo EMAIL -->
        <input
          *ngIf="campo.tipo === 'email'"
          type="email"
          [id]="campo.nombre_campo"
          [(ngModel)]="valoresCamposPersonalizados[campo.nombre_campo]"
          [name]="campo.nombre_campo"
          [placeholder]="campo.placeholder || ''"
          [required]="campo.requerido"
        />

        <!-- Campo TEL -->
        <input
          *ngIf="campo.tipo === 'tel'"
          type="tel"
          [id]="campo.nombre_campo"
          [(ngModel)]="valoresCamposPersonalizados[campo.nombre_campo]"
          [name]="campo.nombre_campo"
          [placeholder]="campo.placeholder || ''"
          [required]="campo.requerido"
        />

        <!-- Campo NUMBER -->
        <input
          *ngIf="campo.tipo === 'number'"
          type="number"
          [id]="campo.nombre_campo"
          [(ngModel)]="valoresCamposPersonalizados[campo.nombre_campo]"
          [name]="campo.nombre_campo"
          [placeholder]="campo.placeholder || ''"
          [required]="campo.requerido"
        />

        <!-- Campo DATE -->
        <input
          *ngIf="campo.tipo === 'date'"
          type="date"
          [id]="campo.nombre_campo"
          [(ngModel)]="valoresCamposPersonalizados[campo.nombre_campo]"
          [name]="campo.nombre_campo"
          [required]="campo.requerido"
        />

        <!-- Campo TEXTAREA -->
        <textarea
          *ngIf="campo.tipo === 'textarea'"
          [id]="campo.nombre_campo"
          [(ngModel)]="valoresCamposPersonalizados[campo.nombre_campo]"
          [name]="campo.nombre_campo"
          [placeholder]="campo.placeholder || ''"
          [required]="campo.requerido"
          rows="4"
        ></textarea>

        <!-- Campo SELECT -->
        <select
          *ngIf="campo.tipo === 'select'"
          [id]="campo.nombre_campo"
          [(ngModel)]="valoresCamposPersonalizados[campo.nombre_campo]"
          [name]="campo.nombre_campo"
          [required]="campo.requerido"
        >
          <option value="" disabled>Selecciona una opci√≥n</option>
          <option *ngFor="let opcion of campo.opciones" [value]="opcion">
            {{ opcion }}
          </option>
        </select>

        <!-- Campo RADIO -->
        <div *ngIf="campo.tipo === 'radio'" class="radio-group">
          <label *ngFor="let opcion of campo.opciones" class="radio-label">
            <input
              type="radio"
              [name]="campo.nombre_campo"
              [value]="opcion"
              [(ngModel)]="valoresCamposPersonalizados[campo.nombre_campo]"
              [required]="campo.requerido"
            />
            <span>{{ opcion }}</span>
          </label>
        </div>

        <!-- Campo CHECKBOX -->
        <div *ngIf="campo.tipo === 'checkbox'" class="checkbox-group">
          <label class="checkbox-label">
            <input
              type="checkbox"
              [name]="campo.nombre_campo"
              [(ngModel)]="valoresCamposPersonalizados[campo.nombre_campo]"
            />
            <span>{{ campo.descripcion_ayuda || campo.etiqueta }}</span>
          </label>
        </div>

        <!-- Campo FILE -->
        <div *ngIf="campo.tipo === 'file'">
          <label [for]="campo.nombre_campo + '_file'" class="label-archivo">
            <span class="icono-upload">üìé</span>
            Seleccionar archivo
          </label>
          <input
            type="file"
            [id]="campo.nombre_campo + '_file'"
            (change)="onCampoFileSelected($event, campo.nombre_campo)"
            [required]="campo.requerido"
            style="display: none"
          />
        </div>

        <!-- Descripci√≥n de ayuda -->
        <small class="help-text" *ngIf="campo.descripcion_ayuda && campo.tipo !== 'checkbox'">
          {{ campo.descripcion_ayuda }}
        </small>
      </div>
    </div>

    <!-- Estado vac√≠o si no hay campos configurados -->
    <div
      class="seccion-formulario"
      *ngIf="!cargandoFormulario && camposPersonalizados.length === 0"
    >
      <div class="empty-state-form">
        <p>‚ö†Ô∏è Este m√≥dulo no tiene campos de formulario configurados.</p>
        <small>Por favor contacta al administrador del sistema.</small>
      </div>
    </div>

    <!-- Botones de acci√≥n -->
    <div class="form-actions">
      <button type="submit" class="btn btn-primary" [disabled]="enviando">
        {{ enviando ? 'Enviando...' : 'Enviar Ticket' }}
      </button>

      <button
        type="button"
        class="btn btn-secondary"
        (click)="resetearFormulario()"
        [disabled]="enviando"
      >
        Limpiar Formulario
      </button>
    </div>

    <p class="nota-privacidad">
      <small>
        Al enviar este formulario, aceptas que tus datos sean utilizados √∫nicamente para atender tu
        solicitud de soporte.
      </small>
    </p>
  </form>
</div>
